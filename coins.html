<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avox Hosting — Rewards & Affiliate Coins</title>
  <meta name="description" content="Earn points by following Avox Hosting on YouTube, Instagram, TikTok and liking our featured Reel. Trade points for rewards."/>
  <link rel="icon" type="image/png" href="https://i.ibb.co/bgtcfhKC/ajaxe.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  
  <!-- Crisp Chat -->
  <script type="text/javascript">
      window.$crisp = [];
      window.CRISP_WEBSITE_ID = "9f59b67a-7d61-4c2a-9329-ff489d39bc2d";
      (function () {
          d = document;
          s = d.createElement("script");
          s.src = "https://client.crisp.chat/l.js";
          s.async = 1;
          d.getElementsByTagName("head")[0].appendChild(s);
      })();
  </script>
  <style>
    :root{
      --bg1:#0a1a2b; /* deep navy */
      --bg2:#0f2d57; /* cobalt */
      --bg3:#0b2344; /* dim blue */
      --primary:#2aa8ff; /* sky blue */
      --primary-2:#5ad1ff; /* lighter */
      --accent:#6dd5ff; /* gradient accent */
      --text:#e8f1ff;
      --muted:#a6c3ff;
      --card:#0c213aee;
      --glass:rgba(12, 33, 58, .65);
      --success:#46e2b2;
      --warning:#ffd166;
      --danger:#ff6b6b;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial; color:var(--text);
      background: radial-gradient(1200px 700px at 10% 0%, #102a4e 0%, transparent 60%),
                  radial-gradient(800px 600px at 90% 10%, #0b2e4f 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    @media (prefers-reduced-motion: reduce){ *{animation:none !important; transition:none !important} }

    /* Floating coins background */
    .coin{ position:fixed; top:-64px; border-radius:50%; pointer-events:none; opacity:.18; filter:drop-shadow(0 6px 12px rgba(0,0,0,.35));
      background: radial-gradient(circle at 30% 30%, #ffeaa7 0%, #f9ca24 40%, #f6b93b 60%, #c79a14 100%);
      box-shadow: inset -6px -12px 18px rgba(0,0,0,.25), inset 4px 4px 10px rgba(255,255,255,.25);
      animation: fall var(--dur) linear var(--delay) infinite;
    }
    @keyframes fall{ to{ transform: translateY(110vh) rotate(360deg); } }

    .btn{ --pad:12px 18px; padding:var(--pad); border-radius:14px; background:linear-gradient(135deg, #1a4b88, #10335a);
      border:1px solid rgba(255,255,255,.08); color:var(--text); text-decoration:none; font-weight:700; letter-spacing:.3px;
      display:inline-flex; align-items:center; gap:10px; transition: transform .2s ease, background .3s ease, box-shadow .3s ease;
      box-shadow:0 10px 24px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.10);
      position:relative; overflow:hidden; cursor:pointer;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow:0 16px 32px rgba(0,0,0,.40); }
    .btn.primary{ background:linear-gradient(135deg, var(--primary), var(--accent)); color:#082036; }
    .btn:after{ content:""; position:absolute; inset:auto auto 0 0; width:0; height:2px; background:linear-gradient(90deg, var(--primary), transparent); transition:width .3s ease }
    .btn:hover:after{ width:100% }
    .btn[disabled]{ opacity:.6; cursor:not-allowed }

    .hero{ position:relative; z-index:2; padding: 18px clamp(16px, 4vw, 40px) 28px; text-align:center; }
    .title{ font-size: clamp(28px, 4.2vw, 52px); margin:8px auto; line-height:1.08; font-weight:800; }
    .subtitle{ font-size: clamp(14px, 1.6vw, 18px); color:var(--muted); max-width:920px; margin:0 auto 10px; }

    .grid{ display:grid; grid-template-columns:repeat(12, 1fr); gap:18px; padding:16px clamp(16px, 4vw, 40px) 60px; position:relative; z-index:2; }
    .card{ grid-column: span 12; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10); backdrop-filter: blur(8px); border-radius:22px; padding:18px; box-shadow: var(--shadow);
      transform: perspective(800px) translateZ(0); transition: transform .25s ease, box-shadow .25s ease;
    }
    .card:hover{ transform: perspective(800px) translateZ(6px); box-shadow: 0 18px 46px rgba(0,0,0,.45); }
    .card h3{ margin:4px 0 10px; font-size: clamp(18px, 2vw, 22px); }
    .muted{ color:var(--muted); }

    .tasks{ display:grid; grid-template-columns: repeat( auto-fit, minmax(260px, 1fr)); gap:14px; }
    .task{ background:linear-gradient(180deg, rgba(12,33,58,.9), rgba(12,33,58,.75)); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:14px;
      position:relative; overflow:hidden; min-height:160px; display:flex; flex-direction:column; justify-content:space-between;
      transition: transform .2s ease, box-shadow .3s ease;
    }
    .task:hover{ transform: translateY(-4px); box-shadow:0 18px 36px rgba(0,0,0,.35) }
    .task .badge{ font-size:12px; font-weight:800; color:#061323; background:linear-gradient(135deg, var(--success), #9bf0d0);
      padding:6px 10px; border-radius:999px; align-self:flex-start; }
    .task h4{ margin:8px 0 6px; font-size:18px; }
    .task p{ margin:0; color:var(--muted); font-size:14px; }
    .task .actions{ display:flex; gap:10px; align-items:center; margin-top:12px; flex-wrap:wrap }
    .task .actions .btn{ --pad:10px 14px; border-radius:12px; font-size:14px; }
    .task.done{ opacity:.75 }
    .task .tick{ position:absolute; right:12px; top:12px; width:24px; height:24px; border-radius:50%; display:grid; place-items:center;
      background:linear-gradient(135deg, #22c55e, #86efac); color:#06351c; font-weight:900; box-shadow:0 8px 20px rgba(34,197,94,.35); display:none; }
    .task.done .tick{ display:grid }

    .hud{ display:grid; grid-template-columns: repeat( auto-fit, minmax(240px, 1fr)); gap:14px; align-items:stretch; }
    .stat{ background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.10);
      border-radius:18px; padding:16px; display:flex; align-items:center; gap:14px; }

    /* Circular progress */
    .ring{ --size:110px; width:var(--size); height:var(--size); position:relative; }
    .ring svg{ transform: rotate(-90deg); }
    .ring .value{ position:absolute; inset:0; display:grid; place-items:center; font-weight:800; font-size:20px; }

    /* Modal */
    dialog{ width:min(560px, 92vw); background:linear-gradient(180deg, rgba(12,33,58,.96), rgba(12,33,58,.85)); color:var(--text);
      border:1px solid rgba(255,255,255,.12); border-radius:18px; padding:0; overflow:hidden; }
    dialog::backdrop{ background: rgba(3,10,18,.6); backdrop-filter: blur(2px); }
    dialog[open]{ display:block; } /* fallback visibility */
    .modal-head{ padding:16px 18px; background:linear-gradient(135deg, var(--primary), var(--accent)); color:#07213a; font-weight:800; }
    .modal-body{ padding:16px 18px; display:grid; gap:12px; }
    .field{ display:grid; gap:8px; }
    .field label{ font-size:14px; color:var(--muted); }
    .input, .file{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px 12px; color:var(--text); }
    .modal-actions{ display:flex; justify-content:flex-end; gap:10px; padding:12px 18px 18px; }

    /* Toast notifications */
    .toast-container{ position:fixed; bottom:20px; right:20px; z-index:1000; display:flex; flex-direction:column; gap:12px; }
    .toast{ min-width:280px; background:var(--card); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:14px 16px;
      display:flex; align-items:center; gap:12px; box-shadow:0 10px 30px rgba(0,0,0,.35); transform:translateX(120%); opacity:0;
      animation: toastIn .4s cubic-bezier(.2,.7,.1,1) forwards, toastOut .4s ease forwards 3s; }
    @keyframes toastIn{ to{ transform:none; opacity:1 } }
    @keyframes toastOut{ to{ transform:translateX(120%); opacity:0 } }
    .toast-icon{ width:24px; height:24px; border-radius:50%; display:grid; place-items:center; flex-shrink:0; }
    .toast.success .toast-icon{ background:var(--success); color:#041f14; }
    .toast.warning .toast-icon{ background:var(--warning); color:#3a2e00; }
    .toast.error .toast-icon{ background:var(--danger); color:#3a0000; }
    .toast-content{ flex:1; font-size:14px; }
    .toast-close{ background:none; border:none; color:var(--muted); cursor:pointer; padding:4px; margin:-4px -4px -4px 0; }

    footer{ padding:28px clamp(16px, 4vw, 40px); color:var(--muted); text-align:center; }

    @keyframes floatUp{ from{ transform: translateY(14px); opacity:0 } to{ transform:none; opacity:1 } }
    .appear{ animation: floatUp .6s ease both; }

    .tooltip{ position:relative; }
    .tooltip .tip{ position:absolute; left:50%; transform:translateX(-50%); bottom:calc(100% + 10px);
      white-space:nowrap; background:#04101e; border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:8px; font-size:12px; display:none; }
    .tooltip:hover .tip{ display:block }

    @media (min-width: 900px){ .card.span-7{ grid-column: span 7 } .card.span-5{ grid-column: span 5 } }
  </style>
</head>
<body>
  <!-- Decorative floating coins -->
  <div id="bg-coins" aria-hidden="true"></div>

  <!-- Toast notifications container -->
  <div class="toast-container" id="toasts"></div>

  <!-- Header -->
  <header class="header">
    <nav class="nav">
      <div class="nav-left">
        <div class="logo">
          <img src="https://i.ibb.co/bgtcfhKC/ajaxe.png" alt="AvoX Host" class="logo-img">
          <span class="logo-text">AVOX HOST</span>
        </div>
      </div>
      <div class="nav-center">
        <a href="index.html" class="nav-link">Home</a>
        <a href="game-servers.html" class="nav-link">Game Servers</a>
        <a href="vps-hosting.html" class="nav-link">VPS Hosting</a>
        <a href="rdp-hosting.html" class="nav-link">RDP Hosting</a>
        <a href="coins.html" class="nav-link active">Rewards</a>
        <a href="https://discord.gg/TCPyhFHrzY" class="nav-link" target="_blank" rel="noopener noreferrer">Our Discord</a>
      </div>
      <div class="nav-right">
        <div class="language-selector">
          <i class="fas fa-globe"></i>
          <span>EN</span>
        </div>
        <a href="https://client.avoxhosting.site/index.php?rp=/login" class="client-area-btn" target="_blank" rel="noopener noreferrer">
          <i class="fas fa-user"></i>
          Client Area
        </a>
        <button class="mobile-menu-btn">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </nav>
  </header>

  <section class="hero appear">
    <div class="title">Earn Coins by Supporting Avox Hosting</div>
    <p class="subtitle">Follow our official pages and like our featured Reel. Each action is worth <strong>2 coins</strong>. Collect coins and unlock rewards.
      <span class="tooltip">ℹ️<span class="tip">Verification is client-side with webhook submission. Admin review may be required.</span></span>
    </p>
    <div style="margin-top: 2rem;">
      <button id="shareBtn" class="btn primary" type="button">Share Referral</button>
    </div>
  </section>

  <section class="grid">
    <div class="card span-7 appear" style="animation-delay:.05s">
      <h3>Tasks (2 coins each)</h3>
      <div class="tasks" id="tasks"><!-- injected --></div>
    </div>

    <div class="card span-5 appear" style="animation-delay:.10s">
      <h3>Your Wallet</h3>
      <div class="hud">
        <div class="stat">
          <div class="ring" aria-label="progress">
            <svg width="110" height="110" viewBox="0 0 110 110">
              <circle cx="55" cy="55" r="48" stroke="rgba(255,255,255,.15)" stroke-width="10" fill="none"/>
              <circle id="progArc" cx="55" cy="55" r="48" stroke="url(#g1)" stroke-linecap="round" stroke-width="10" fill="none" stroke-dasharray="0 999"/>
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0%" stop-color="var(--primary)"/>
                  <stop offset="100%" stop-color="var(--accent)"/>
                </linearGradient>
              </defs>
            </svg>
            <div class="value"><span id="coinTotal">0</span> 🪙</div>
          </div>
          <div>
            <div style="font-weight:800; font-size:18px">Coins</div>
            <div class="muted" style="font-size:13px">Max today: <span id="maxCoins">0</span></div>
          </div>
        </div>
        <div class="stat">
          <div>
            <div style="font-weight:800; font-size:18px">Referral Link</div>
            <div class="muted" id="refLink" style="word-break:break-all; font-size:12px; margin-top:6px"></div>
          </div>
          <button class="btn" id="copyRef" type="button">Copy</button>
        </div>
      </div>
    </div>

    <div class="card appear" id="rewards" style="animation-delay:.15s">
      <h3>Rewards</h3>
      <p class="muted" style="margin-top:-4px">These are example tiers. Replace with your actual prizes/coupons.</p>
      <div class="tasks">
        <div class="task" data-need="4">
          <span class="badge">4+ coins</span>
          <h4>Community Shoutout</h4>
          <p>Get a shoutout on our story or Discord.</p>
          <div class="actions"><button class="btn" data-claim>Claim</button></div>
        </div>
        <div class="task" data-need="8">
          <span class="badge">8+ coins</span>
          <h4>5% Off Hosting</h4>
          <p>Single-use coupon on your next purchase.</p>
          <div class="actions"><button class="btn" data-claim>Claim</button></div>
        </div>
        <div class="task" data-need="12">
          <span class="badge">12+ coins</span>
          <h4>Featured Supporter</h4>
          <p>Get listed on our supporters wall.</p>
          <div class="actions"><button class="btn" data-claim>Claim</button></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Verify Modal -->
  <dialog id="verifyModal">
    <div class="modal-head">Submit Proof</div>
    <!-- no method='dialog' to avoid submit quirks -->
    <form id="verifyForm" novalidate>
      <div class="modal-body">
        <div class="field">
          <label for="handle">Your handle on this platform</label>
          <input id="handle" class="input" type="text" placeholder="@yourname" required />
        </div>
        <div class="field">
          <label for="discord">Your Discord username</label>
          <input id="discord" class="input" type="text" placeholder="username#1234 or @name" required />
        </div>
        <div class="field">
          <label for="file">Optional screenshot</label>
          <input id="file" class="file" type="file" accept="image/*" />
        </div>
        <div class="muted" style="font-size:12px">Note: This page submits your proof to our Discord review channel via webhook.</div>
      </div>
      <div class="modal-actions">
        <button class="btn" id="cancelVerify" type="button">Cancel</button>
        <button class="btn primary" id="confirmVerify" type="submit">Submit</button>
      </div>
    </form>
  </dialog>

  <footer>
    © <span id="year"></span> Avox Hosting. All rights reserved. • <span class="muted">Built with ❤️ by AvX DeveloperS.</span>
  </footer>

  <script src="script.js"></script>
  <script>
    // -------------------- CONFIG --------------------
    const CONFIG = {
      coinPerTask: 2,
      webhook: 'https://discord.com/api/webhooks/1401937015230169149/WEJCUtxhytdk1N49106OA3YOIv3Y6rlAkRaT8N0Aw2s31turq_jb8BqbeXFeneU-fqHx',
      tasks: [
        { id: 'yt-follow',   title: 'Follow our YouTube',      desc: 'YouTube @Avox-Hosting',                           url: 'https://www.youtube.com/@Avox-Hosting',                   icon: '▶️' },
        { id: 'ig-follow',   title: 'Follow our Instagram',    desc: '@avoxhost',                                       url: 'https://www.instagram.com/avoxhost/',                      icon: '📸' },
        { id: 'tt-follow',   title: 'Follow our TikTok',       desc: '@avoxhosting',                                    url: 'https://www.tiktok.com/@avoxhosting',                      icon: '🎵' },
        { id: 'ig-like-reel',title: 'Like this Instagram Reel',desc: 'Open the featured reel and like it',              url: 'https://www.instagram.com/avoxhost/reel/DNVHjAzNJR1/',    icon: '💙' }
      ]
    };

    // -------------------- STATE --------------------
    const storeKey = 'avoxCoinsV3';
    const state = safeParse(localStorage.getItem(storeKey)) || {};
    if(!state.progress){ state.progress = {}; }
    if(!state.ref){ state.ref = safeUUID(); }

    // -------------------- HELPERS --------------------
    const $ = (sel, root=document) => root.querySelector(sel);
    const el = (tag, props={}, children=[]) => { const e=document.createElement(tag); Object.assign(e, props); for(const c of children) e.append(c); return e; };
    const save = () => localStorage.setItem(storeKey, JSON.stringify(state));
    function safeParse(v){ try{ return JSON.parse(v); }catch{ return null; } }
    function safeUUID(){
      try{ if (crypto && crypto.randomUUID) return crypto.randomUUID(); }catch{}
      // fallback RFC4122-ish v4
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c=>{
        const r = Math.random()*16|0, v = c==='x'? r : (r&0x3|0x8);
        return v.toString(16);
      });
    }

    // Toast notification system
    function showToast(message, type = 'success', duration = 3000) {
      const container = $('#toasts');
      const toast = el('div', { className: `toast ${type}` }, [
        el('div', { className: 'toast-icon', innerHTML: type === 'success' ? '✓' : type === 'warning' ? '!' : '✕' }),
        el('div', { className: 'toast-content', textContent: message }),
        el('button', { className: 'toast-close', innerHTML: '&times;', onclick: () => toast.remove() })
      ]);
      
      container.appendChild(toast);
      setTimeout(() => toast.remove(), duration);
    }

    // Lightweight confetti
    function confettiBurst(x = innerWidth/2, y = innerHeight/3){
      const colors = ['#ffffff','#e6f7ff','#99ddff','#66ccff','#33bbff','#00aaff'];
      const n = 80; const frag = document.createDocumentFragment();
      for(let i=0;i<n;i++){
        const p = document.createElement('div');
        p.style.position='fixed'; p.style.left=x+'px'; p.style.top=y+'px'; p.style.width=p.style.height=(Math.random()*6+4)+'px';
        p.style.background=colors[Math.floor(Math.random()*colors.length)];
        p.style.transform=`translate(-50%,-50%) rotate(${Math.random()*360}deg)`;
        p.style.borderRadius = Math.random()>.6?'50%':'3px'; p.style.opacity='0.95'; p.style.zIndex=9999;
        const dx = (Math.random()-0.5)*2; const dy = (Math.random()-0.8)*2; const dur = 800 + Math.random()*900;
        p.animate([
          { transform: p.style.transform, opacity:1 },
          { transform: `translate(calc(-50% + ${dx*120}px), calc(-50% + ${dy*200}px)) rotate(${Math.random()*720}deg)`, opacity: 0 }
        ], { duration: dur, easing: 'cubic-bezier(.2,.7,.1,1)', fill:'forwards' }).onfinish = () => p.remove();
        frag.appendChild(p);
      }
      document.body.appendChild(frag);
    }

    // Progress ring update
    function setProgress(cur, max){
      const circle = document.getElementById('progArc');
      const r = 48; const circ = 2*Math.PI*r; const pct = Math.max(0, Math.min(1, cur / Math.max(1,max)));
      const dash = pct * circ; circle.setAttribute('stroke-dasharray', `${dash} ${circ}`);
    }

    // Render tasks
    function renderTasks(){
      const wrap = document.getElementById('tasks');
      wrap.innerHTML = '';
      CONFIG.tasks.forEach(t => {
        const done = !!state.progress[t.id];
        const card = el('div', { className: 'task' + (done?' done':'') });
        const openBtn = el('a', { className:'btn', href: t.url, target:'_blank', rel:'noopener noreferrer', innerText: 'Open' });
        const verifyBtn = el('button', { className:'btn primary', type:'button', innerText: done ? 'Verified' : 'Verify', disabled: done });
        verifyBtn.addEventListener('click', () => openVerify(t.id));

        card.append(
          el('span', { className:'badge', innerText: `${CONFIG.coinPerTask} coins` }),
          el('div', { className:'tick', innerText:'✓' }),
          el('h4', { innerText: `${t.icon} ${t.title}` }),
          el('p', { innerText: t.desc }),
          el('div', { className:'actions' }, [openBtn, verifyBtn])
        );
        wrap.append(card);
      });
    }

    function calcCoins(){ return Object.values(state.progress).filter(Boolean).length * CONFIG.coinPerTask; }

    function updateHUD(){
      const coins = calcCoins();
      $('#coinTotal').innerText = coins;
      $('#maxCoins').innerText = CONFIG.tasks.length * CONFIG.coinPerTask;
      setProgress(coins, CONFIG.tasks.length * CONFIG.coinPerTask);
    }

    // Verify modal logic (with dialog fallback)
    let pendingTaskId = null;
    const modal = document.getElementById('verifyModal');
    const supportsDialog = typeof HTMLDialogElement === 'function' && 'showModal' in HTMLDialogElement.prototype;
    if(!supportsDialog){
      // simple polyfill
      modal.showModal = () => { modal.setAttribute('open',''); modal.style.display = 'block'; document.body.style.overflow='hidden'; };
      modal.close = () => { modal.removeAttribute('open'); modal.style.display = 'none'; document.body.style.overflow=''; };
    }
    function openVerify(taskId){ 
      pendingTaskId = taskId; 
      document.getElementById('handle').value = '';
      document.getElementById('discord').value = '';
      document.getElementById('file').value = '';
      modal.showModal(); 
    }

    // Close on cancel
    document.getElementById('cancelVerify').addEventListener('click', () => modal.close());

    // Handle submit (works across browsers)
    const verifyForm = document.getElementById('verifyForm');
    verifyForm.addEventListener('submit', handleVerifySubmit);
    function handleVerifySubmit(e){
      e && e.preventDefault();
      if(!pendingTaskId){ modal.close(); return; }
      const handle = document.getElementById('handle').value.trim();
      const discord = document.getElementById('discord').value.trim();
      const file = document.getElementById('file').files[0];
      if(!handle || !discord){ 
        showToast('Please fill all required fields', 'warning');
        return; 
      }

      const proof = { handle, discord, ts: Date.now(), ref: state.ref, task: pendingTaskId, location: location.href, ua: navigator.userAgent };

      if(file){
        const form = new FormData();
        form.append('payload_json', JSON.stringify({
          content: `✅ New verification submitted`,
          embeds: [
            { title:'Avox Verification', fields:[
                { name:'Task', value: pendingTaskId, inline:true },
                { name:'Handle', value: handle, inline:true },
                { name:'Discord', value: discord, inline:true },
                { name:'Ref', value: state.ref, inline:false },
                { name:'URL', value: location.href, inline:false }
              ],
              timestamp: new Date().toISOString()
            }
          ]
        }));
        form.append('file', file, file.name || 'proof.png');
        sendWebhook(form, true, proof);
      } else {
        const payload = {
          content: `✅ New verification submitted`,
          embeds: [
            { title:'Avox Verification', fields:[
                { name:'Task', value: pendingTaskId, inline:true },
                { name:'Handle', value: handle, inline:true },
                { name:'Discord', value: discord, inline:true },
                { name:'Ref', value: state.ref, inline:false },
                { name:'URL', value: location.href, inline:false }
              ], timestamp: new Date().toISOString() }
          ]
        };
        sendWebhook(payload, false, proof);
      }
    }

    async function sendWebhook(body, isForm, proof){
      try{
        showToast('Submitting verification...', 'success');
        const btn = $('#confirmVerify');
        btn.disabled = true;
        btn.textContent = 'Sending...';
        
        await fetch(CONFIG.webhook, {
          method:'POST',
          mode: 'no-cors', // avoid CORS crashes so buttons keep working
          headers: isForm? undefined : { 'Content-Type':'application/json' },
          body: isForm? body : JSON.stringify(body)
        });
        
        showToast('Verification submitted!', 'success');
        commitVerify(proof);
      }catch(err){
        console.warn('Webhook send failed (network/CORS). Proceeding locally.', err);
        showToast('Submitted locally (network issue)', 'warning');
        commitVerify(proof);
      } finally {
        const btn = $('#confirmVerify');
        btn.disabled = false;
        btn.textContent = 'Submit';
      }
    }

    function commitVerify(proof){
      if(!pendingTaskId) return;
      state.progress[pendingTaskId] = proof; // mark verified
      save();
      modal.close();
      renderTasks();
      updateHUD();
      confettiBurst();
      showToast(`+${CONFIG.coinPerTask} coins earned!`, 'success');
    }

    // Rewards "Claim" buttons
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-claim]');
      if(!btn) return;
      const card = btn.closest('.task');
      const need = parseInt(card?.dataset.need || '0', 10);
      const coins = calcCoins();
      if(coins < need){
        showToast(`You need ${need} coins (have ${coins})`, 'warning');
        return;
      }
      const payload = {
        content: '🎁 Reward claim',
        embeds: [{ title:'Reward Claim', fields:[
          { name:'Coins', value: String(coins), inline:true },
          { name:'Required', value: String(need), inline:true },
          { name:'Ref', value: state.ref, inline:false }
        ], timestamp: new Date().toISOString() }]
      };
      btn.disabled = true;
      btn.textContent = 'Processing...';
      sendWebhook(payload, false, { claim: true, need, coins, ts: Date.now() })
        .then(() => {
          showToast('Claim submitted! We\'ll contact you soon.', 'success');
        })
        .catch(() => {
          showToast('Claim submitted locally', 'warning');
        })
        .finally(() => {
          btn.disabled = false;
          btn.textContent = 'Claim';
        });
    });

    // Referral handling
    function getBaseURL(){ const { protocol, host, pathname } = window.location; return protocol + '//' + host + pathname; }
    function buildRefLink(){ const url = new URL(getBaseURL()); url.searchParams.set('ref', state.ref); return url.toString(); }

    const refDiv = document.getElementById('refLink');
    const copyBtn = document.getElementById('copyRef');
    copyBtn.addEventListener('click', async () => {
      const txt = refDiv.textContent;
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){
          await navigator.clipboard.writeText(txt);
        } else {
          const ta = document.createElement('textarea');
          ta.value = txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
        }
        copyBtn.textContent = 'Copied!'; 
        setTimeout(()=> copyBtn.textContent='Copy', 1200);
        showToast('Referral link copied!', 'success');
      }catch(err){ 
        showToast('Failed to copy link', 'error');
      }
    });

    // Share button
    document.getElementById('shareBtn').addEventListener('click', async () => {
      const shareData = { title:'Avox Hosting — Rewards', text:'Earn coins by supporting Avox Hosting', url: buildRefLink() };
      try{
        if(navigator.share){ 
          await navigator.share(shareData); 
          showToast('Shared successfully!', 'success');
        }
        else {
          await (navigator.clipboard?.writeText?.(shareData.url));
          showToast('Referral link copied!', 'success');
        }
      }catch(err){
        showToast('Share cancelled', 'warning');
      }
    });

    // Decorative background coins
    function spawnCoins(){
      const wrap = document.getElementById('bg-coins');
      for(let i=0;i<16;i++){
        const c = document.createElement('div'); c.className='coin';
        const size = 24 + Math.random()*42; c.style.width=size+'px'; c.style.height=size+'px';
        c.style.left = (Math.random()*100)+'vw';
        c.style.setProperty('--dur', (9+Math.random()*8)+'s');
        c.style.setProperty('--delay', (Math.random()*-10)+'s');
        wrap.appendChild(c);
      }
    }

    // Init (in try/catch so a single error doesn't kill all buttons)
    (function init(){
      try{
        document.getElementById('year').textContent = new Date().getFullYear();
        renderTasks();
        updateHUD();
        refDiv.textContent = buildRefLink();
        spawnCoins();

        const incomingRef = new URLSearchParams(location.search).get('ref');
        if(incomingRef){
          const note = document.createElement('div');
          note.className = 'card appear'; note.style.marginTop = '-20px';
          note.innerHTML = '<strong>Welcome!</strong> You arrived via referral: <code style="color:#9bd0ff">'+incomingRef+'</code>';
          document.querySelector('.grid').prepend(note);
          showToast('Welcome! You came via referral link', 'success');
        }
      }catch(err){
        console.error('Init error:', err);
        showToast('A script error occurred. Please refresh.', 'error');
      }
    })();
  </script>
</body>
</html>